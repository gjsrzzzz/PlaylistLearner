@page "/"
@using PlaylistLearner.Model

<PageTitle>Playlist Learner</PageTitle>

<h1>Dance Moves</h1>

<div class="container">
    @foreach (var item in Playlist.Salsa.Items)
    {
        <div class="row">
            @if (item.Link.Length > 0)
            {
                <div class="col-sm themed-grid-col"><h2><a href="" @onclick="() => ShowVideo(item.Name)" @onclick:preventDefault  target="_blank">@item.Name</a>&nbsp;
                    @if (ShowVideos.Contains(item.Name))
                    {
                        <button type="button" @onclick="() => HideVideo(item.Name)" class="btn btn-primary">Hide</button>
                        <a href="@item.Link" @onclick="() => ShowVideo(item.Name)" target="_blank">Video</a>
                        <div style="position:relative;padding-bottom:56.25%;">
                            <iframe frameborder="0" allowfullscreen style="width:100%;height:100%;position:absolute;left:0px;top:0px;" allow="autoplay"
                                    src="@Embed(item.Link)">
                            </iframe>
                        </div>
                    }
                    else
                    {

                        <!--button type="button" @onclick="() => ShowVideo(move.Name)" class="btn btn-primary">Show</button -->
                    }
                    </h2></div>
            }
            else
            {
                <div class="col-sm themed-grid-col">
                    <h2>@item.Name</h2>
                </div>
            }
            @if (item.AltName.Length > 0)
            {
                <div class="col-sm themed-grid-col">@item.AltName</div>
            }
            @if (item.Description.Length > 0)
            {
                <div class="col-sm themed-grid-col">@item.Description</div>
            }


        </div>
    }
</div>

@code
{
    private HashSet<string> ShowVideos { get; } = new();
    void ShowVideo(string name)
    {
        ShowVideos.Clear();
        ShowVideos.Add(name);
    }
    void HideVideo(string name)
    {
        ShowVideos.Remove(name);
    }

    string Embed(string link)
    {
        link = link.Contains("watch") ? link.Replace("/watch?v=", "/embed/") : 
            link.Replace("https://youtu.be/", "https://www.youtube.com/embed/");
        link += "?autoplay=1";
        return link;
    }
}
